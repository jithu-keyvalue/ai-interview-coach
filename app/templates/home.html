<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Home - AI Coach</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding-top: 60px;
    }
    #logoutBtn {
      position: absolute;
      top: 20px;
      right: 30px;
    }
    #settingsBtn {
      position: absolute;
      top: 20px;
      right: 120px;
    }
    #chat {
      margin-top: 50px;
      width: 400px;
    }
    textarea {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
    }
    button {
      padding: 10px 15px;
      background: black;
      color: white;
      border: none;
      margin-top: 10px;
      cursor: pointer;
    }
    #chatReply {
      margin-top: 20px;
      white-space: pre-wrap;
      background: #f1f1f1;
      padding: 10px;
    }
  </style>
</head>
<body>
  <div style="position: absolute; top: 20px; left: 30px; font-size: 1.2rem; font-weight: bold;">
    AI Interview Coach
  </div>
  <button id="settingsBtn" onclick="window.location.href='settings.html'">Settings</button>
  <button id="logoutBtn">Logout</button>

  <h1 id="welcomeText">Welcome, <span id="username">Loading...</span></h1>

  <!--# üìù TODO: Something is wrong in how we handle click event!-->

  <div id="chat">
    <textarea id="chatInput" rows="4" placeholder="Ask the coach something..."></textarea>
    <button onclick="sendTheChat()">Ask</button>
    <div id="chatReply"></div>
  </div>

  <script>
    const token = localStorage.getItem('token');
    if (!token) window.location.href = 'login.html';

    fetch('http://localhost:8000/api/me', {
      headers: { Authorization: `Bearer ${token}` }
    })
    .then(res => res.json())
    .then(data => {
      if (data.name) document.getElementById('username').innerText = data.name;
      else window.location.href = 'login.html';
    });

    document.getElementById('logoutBtn').onclick = () => {
      localStorage.removeItem('token');
      window.location.href = 'login.html';
    };

    async function sendChat() {
      const msg = document.getElementById('chatInput').value;
      if (!msg.trim()) return;

      // # üìù TODO: Check if we are calling the API properly, with the right payload, etc.
      const res = await fetch("http://localhost:8000/api/chat", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          Authorization: "Bearer " + token
        },
        body: JSON.stringify({ msg: msg })
      });

      const data = await res.json();
      // # üìù TODO: data.message looks okay? what really is the structure of backend response?
      document.getElementById("chatReply").innerText = data.message || "No reply.";
    }
  </script>
</body>
</html>
